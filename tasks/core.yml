- name: Install system packages
  become: true
  community.general.xbps:
    name:
    - base-devel
    - cmake
    - pkg-config
    - acpi
    - polkit
    - acl
    - void-repo-nonfree
    state: present
  tags:
  - setup
  - core

- name: Add nonfree repository
  become: true
  community.general.xbps:
    name:
    - void-repo-nonfree
    state: present
  tags:
  - setup
  - core

- name: CLI tools
  become: true
  community.general.xbps:
    name: 
    - bc
    - tree
    - tldr
    - pulsemixer
    - fzf
    - fd
    - tmux
    - exa
    - nano
    - bat
    - htop
    - ripgrep
    - unzip
    - wget
    - fish-shell
    state: present
  tags:
  - setup
  - core

- name: Neovim
  become: true
  community.general.xbps:
    name: 
    - python3-neovim
    - python3-pip
    - neovim
    - tree-sitter
    - luarocks
    state: present
  tags:
  - setup
  - core
  - neovim

- name: Desktop environment
  become: true
  community.general.xbps:
    name: 
    - xorg
    - ibus
    - xautolock
    - i3lock-color
    - maim
    - xclip
    - Thunar
    - gsettings-desktop-schemas
    - direnv
    - xsel
    - cups
    - pipewire
    - wireplumber
    - alsa-utils
    - bluez
    - bluez-alsa
    - bluez-cups
    - lxappearance
    - lxsession
    - network-manager-applet
    - playerctl
    - picom
    - starship
    - rofi
    - xdg-user-dirs
    - xf86-input-evdev
    - xf86-input-libinput
    - xf86-input-synaptics
    - xf86-input-vmmouse
    - xf86-input-wacom
    - xf86-video-amdgpu
    - xf86-video-intel
    - xf86-video-nouveau
    - xf86-video-openchrome
    - xf86-video-qxl
    - xf86-video-vmware
    - zathura
    - zathura-pdf-poppler
    - firefox
    - alacritty
    - xterm
    - qtile
    - awesome
    - leftwm
    - polybar
    - gtk-theme-config
    - paper-gtk-theme
    - adwaita-icon-theme
    - arc-icon-theme
    - paper-icon-theme
    - papirus-icon-theme
    - tuigreet
    - elogind
    state: present

- name: Create user dirs
  shell: xdg-user-dirs-update

- name: Enable dbus service
  become: true
  community.general.runit:
    name: dbus
    enabled: true

# - name: Enable greetd service
  #   become: true
  # community.general.runit:
    #   name: greetd
    # enabled: true

- name: Enable elogind service
  become: true
  community.general.runit:
    name: elogind
    enabled: true

- name: Enable bluetoothd service
  become: true
  community.general.runit:
    name: bluetoothd
    enabled: true

# - name: Enable alsa service
#   become: true
#   community.general.runit:
#     name: alsa
#     enabled: true

- name: Enable bluez-alsa service
  become: true
  community.general.runit:
    name: bluez-alsa
    enabled: true

- name: Enable cupsd service
  become: true
  community.general.runit:
    name: cupsd
    enabled: true

- name: Desktop environment (Wayland)
  become: true
  community.general.xbps:
    name: 
    - wl-clipboard
    - wayland-protocols
    - arandr
    - mako
    - foot
    - qtile-wayland
    - sway
    - swaybg
    - swayidle
    - swaylock
    - Waybar
    - python3-psutil
    - python3-dbus
    - xdg-desktop-portal-wlr
    - xdg-desktop-portal-gtk
    state: present

- name: Virtualization
  become: true
  community.general.xbps:
    name:
    - qemu
    state: present

# n (node), rustup
- name: Development
  become: true
  community.general.xbps:
    name: 
    - go
    state: present

- name: n checkout
  git:
    repo: https://github.com/tj/n.git
    dest: /tmp/n
    force: true

- name: Make n
  shell: PREFIX=$HOME/.local/n make install
  args:
    chdir: /tmp/n

- name: Install node LTS
  shell: n lts

- name: check if cargo is installed
  shell: command -v cargo
  register: cargo_exists
  ignore_errors: true

- name: Download rustup installer
  when: cargo_exists is failed
  get_url:
    url: https://sh.rustup.rs
    dest: /tmp/sh.rustup.rs
    mode: '0755'
    force: 'yes'
  tags:
    - rust

- name: install rust/cargo
  when: cargo_exists is failed
  shell: /tmp/sh.rustup.rs -y
  tags:
    - rust

- name: Multimedia
  become: true
  community.general.xbps:
    name: 
    - mpv
    state: present

- name: Fonts
  become: true
  community.general.xbps:
    name: 
    - nerd-fonts
    - font-awesome6
    state: present

